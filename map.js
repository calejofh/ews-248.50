// Inicialización del mapa (centro aproximado)
var map = L.map('map').setView([-0.47, -76.99], 14);

// =============================
// Capas base
// =============================
var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map); // OSM por defecto

var esriSat = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Tiles © Esri — World Imagery' }
);

// =============================
// Layer 1: Barrios afectados (MultiPolygon)
// =============================
var barriosAfectados = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": { "Layer": "BARRIO 24 DE MAYO" },
      "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
          [[
            [-76.988954959687376, -0.467564335349018],
            [-76.986806941380351, -0.471861416845519],
            [-76.991554123032728, -0.474250100359627],
            [-76.991251679747435, -0.472611941065274],
            [-76.990773094310057, -0.472391644002069],
            [-76.992307506428915, -0.469339415289035],
            [-76.988954959687376, -0.467564335349018]
          ]]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": { "Layer": "BARRIO 30 DE ABRIL" },
      "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
          [[
            [-76.990288215743931, -0.477074744513631],
            [-76.99042500449336, -0.476841043742866],
            [-76.990401106012754, -0.476675502261985],
            [-76.990703967813985, -0.476460536435009],
            [-76.990798125038623, -0.476271906957518],
            [-76.991049919884702, -0.476271856018818],
            [-76.99136364751952, -0.47571403978749],
            [-76.991547595922228, -0.475684462792403],
            [-76.991695324569207, -0.475143287361023],
            [-76.991516000138745, -0.474950247402471],
            [-76.991697775504349, -0.474664800234204],
            [-76.991669020612491, -0.474447343356976],
            [-76.991413362560579, -0.474315146711232],
            [-76.991300204711649, -0.474254320631013],
            [-76.990834293485364, -0.474033811779484],
            [-76.990720981224854, -0.473977713426712],
            [-76.990250638069924, -0.473743485749197],
            [-76.990169940743698, -0.473687811401674],
            [-76.989084290109702, -0.473153421103435],
            [-76.988972971797637, -0.473099645350694],
            [-76.988388935838373, -0.472799975856257],
            [-76.98791454745988, -0.472566101495941],
            [-76.987810419849197, -0.472506946133401],
            [-76.987333079171336, -0.472265425723301],
            [-76.987228788688242, -0.472204445044607],
            [-76.986758713619366, -0.47196723223742],
            [-76.986531668061744, -0.472417968735409],
            [-76.986474937628387, -0.472545563594493],
            [-76.986258975086173, -0.472979982621944],
            [-76.986205856095197, -0.47309382318139],
            [-76.985924446984015, -0.473672220225951],
            [-76.985865202960582, -0.473793940459841],
            [-76.985572169581388, -0.474371738212361],
            [-76.985387384926383, -0.474769872985326],
            [-76.985339177787196, -0.474844257308562],
            [-76.985303014615909, -0.474922174068279],
            [-76.985363462332757, -0.474958403081315],
            [-76.985783384019683, -0.475180898375973],
            [-76.985856232062503, -0.475197681805034],
            [-76.986227478955144, -0.4753688135221],
            [-76.987681051668559, -0.475805222767922],
            [-76.987779823375874, -0.475877806673254],
            [-76.988259477017067, -0.476112868139588],
            [-76.988354965614718, -0.476182665766583],
            [-76.988818803498802, -0.476406891928555],
            [-76.989355495118488, -0.476717399379068],
            [-76.9899157986668, -0.476969779889219],
            [-76.990288215743931, -0.477074744513631],
            [-76.990288215743931, -0.477074744513631]
          ]]
        ]
      }
    }
  ]
};

var layer1 = L.geoJSON(barriosAfectados, {
  style: { color: "red", weight: 2, fillColor: "pink", fillOpacity: 0.5 },
  onEachFeature: function (feature, layer) {
    if (feature.properties && feature.properties.Layer) {
      layer.bindPopup("<b>" + feature.properties.Layer + "</b>");
    }
  }
}).addTo(map);

// Ajustar vista a los barrios
if (layer1 && layer1.getLayers().length) {
  map.fitBounds(layer1.getBounds());
}

// =============================
// Layer 2: Red Hídrica (desde red_hidrica.js)
// =============================
const WATER_COLOR = "blue";
const WATER_ALPHA  = 0.5;

var layer2 = L.geoJSON(redHidrica, {
  style: function () {
    return {
      color: WATER_COLOR,
      opacity: WATER_ALPHA,
      weight: 2,
      fill: true,
      fillColor: WATER_COLOR,
      fillOpacity: WATER_ALPHA
    };
  },
  onEachFeature: function (feature, layer) {
    if (feature.properties && feature.properties.name) {
      layer.bindPopup("<b>" + feature.properties.name + "</b>");
    }
  }
}).addTo(map);

// =============================
// Controles
// =============================
var baseMaps = {
  "OSM": osm,
  "ESRI Satélite": esriSat
};

var overlayMaps = {
  "Barrios afectados": layer1,
  "Red Hídrica": layer2
};

L.control.layers(baseMaps, overlayMaps, { collapsed: false }).addTo(map);
